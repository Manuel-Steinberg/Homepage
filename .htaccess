# Developer Options - No Cache
#Header add "disablevcache" "true"
#<FilesMatch "\.(html|htm|js|css|php)>
#FileETag None
#Header unset ETag
#Header set Cache-Control "max-age=0, no-cache, no-store, must-revalidate"
#Header set Pragma "no-cache"
#Header set Expires "Wed, 11 Jan 1984 05:00:00 GMT"
#</FilesMatch>

# Production Options - Cache
#<IfModule mod_expires.c>
#ExpiresActive On
#ExpiresDefault "access plus 10 days"
#ExpiresByType text/css "access plus 1 week"
#ExpiresByType text/plain "access plus 1 month"
#ExpiresByType image/gif "access plus 1 month"
#ExpiresByType image/png "access plus 1 month"
#ExpiresByType image/jpeg "access plus 1 month"
#ExpiresByType application/x-javascript "access plus 1 month"
#ExpiresByType application/javascript "access plus 1 week"
#ExpiresByType application/x-icon "access plus 1 year"
#</IfModule>

# Developer Options - Authentification
#AuthName "Developer Area"
#AuthType Basic
#AuthUserFile /srv/users/serverpilot/apps/dev-manuel-steinberg-de/public/.htpasswd
#AuthGroupFile /
#AuthMerging And
#Require valid-user

# Set Environment Variable
#SetEnv HTTP_ENV DEV
SetEnv HTTP_ENV PROD

# Security Header
Header set Content-Security-Policy "default-src 'self'; script-src 'self' *.cloudflare.com *.manuel-steinberg.de; child-src 'self'; connect-src 'self'; img-src 'self' *.cloudflare.com *.manuel-steinberg.de; style-src 'self' unpkg.com fonts.googleapis.com; font-src 'self' fonts.gstatic.com;"
Header set Strict-Transport-Security "max-age=10886400; includeSubDomains; preload" env=HTTPS
Header set X-Xss-Protection "1; mode=block"
Header set X-Content-Type-Options nosniff
Header set X-Frame-Options SAMEORIGIN

# Disable Server Signature
ServerSignature Off
FileETag None

# Charset
AddDefaultCharset UTF-8

# Force HTTPS + WWW (Only For Production)
<IfModule mod_rewrite.c>
RewriteEngine on
RewriteCond %{HTTP_HOST} !^www
RewriteRule ^(.*) https://www.manuel-steinberg.de/$1 [L,R=301]
RewriteCond %{HTTPS} off
RewriteRule .* https://%{SERVER_NAME}%{REQUEST_URI} [R=301,L]
</IfModule>

# Deny Access To .htaccess
<FilesMatch "(\.htaccess|\.htpasswd|\.gitignore|\.gitmodules)">
 order deny,allow
 deny from all
</FilesMatch>

#################
# Kirby .htaccess

# rewrite rules
<IfModule mod_rewrite.c>

# enable awesome urls. i.e.:
# http://yourdomain.com/about-us/team
RewriteEngine on

# make sure to set the RewriteBase correctly
# if you are running the site in a subfolder.
# Otherwise links or the entire site will break.
#
# If your homepage is http://yourdomain.com/mysite
# Set the RewriteBase to:
#
RewriteBase /

# block text files in the content folder from being accessed directly
RewriteRule ^content/(.*)\.(txt|md|mdown)$ index.php [L]

# block all files in the site folder from being accessed directly
# except for requests to plugin assets files
#RewriteRule ^assets/plugins/([a-zA-Z0-9\.\-_%=]+)/(.*)$ site/plugins/$1/assets/$2 [L,N]
#RewriteCond $1 !^plugins/[a-zA-Z0-9\.\-_%=]+/assets/.*
RewriteRule ^site/(.*) index.php [L]

# block all files in the kirby folder from being accessed directly
RewriteRule ^kirby/(.*) index.php [L]

# block all files in the addons/jobs folder from being accessed directly
RewriteRule ^addons/(.*) index.php [L]
RewriteRule ^jobs/(.*) index.php [L]

# make panel links work
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^panel/(.*) panel/index.php [L]

# make site links work
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*) index.php [L]

</IfModule>

# Additional recommended values
# Remove comments for those you want to use.
#
# AddDefaultCharset UTF-8
#
# php_flag short_open_tag on